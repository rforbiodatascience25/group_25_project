---
title: "Group 25 Project"
author:
  - "André Godinho s253707"
  - "Szymon Cholewiński s253711"
  - "Magnus Strange s190867 "
  - "Lily Whipple s243865"
  - "Catarina Anastácio s253709"
format:
  revealjs: 
    theme: serif # choose different themes
    logo: DTU_logo.png #choose a logo to put in here
    footer: "R for Bio Data Science 2025 - Group 25 Project"
    code-block-height: 500px # maximum height of a code block, if it surpases this height becames scrollbar
    css: 
      - presentation_css.css
bibliography: references.bib
reference-location: section
---

```{r}
#| echo: false
#| eval: true
#| output: false
#| message: false
# package import
library("tidyverse")
library("here")
library("broom")
```

```{r}
#| echo: false
#| eval: true
#| output: false
#| message: false
# data input
data_metrics <- read_tsv(here("data","data_metrics_aug.tsv"))
data_gene <- read_tsv(here("data","data_gene_aug.tsv"))
data_score <- read_tsv(here("data","data_score_aug.tsv"))
data_code <- read_tsv(here("data","data_code_aug.tsv"))
data_diag <- read_tsv(here("data","data_diag_aug.tsv"))
```

## Introduction

-   Analysis of Pancreatic Adenocarcinoma The Cancer Genome Atlas (TCGA) PanCancer data [@BioPortal; @TCGA_data]

-   Pancreatic cancers estimated deaths rank 3rd across cancers in USA in 2025 [@CancStat] -\> relevant data

-   Data contained cancer genomic data, scores and classification -\> enough information to perform analysis

-   After initial analysis it didn't look tidy -\> ideal for the project purposes

::::::: columns
:::: {.column width="50%"}
::: {style="text-align: center;"}
![](ExampleTissue.png){width="500"}
:::
::::

:::: {.column width="50%"}
::: {style="text-align: center;"}
![](ExampleTissue2.png){width="500"}
:::
::::
:::::::

::: {style="font-size: 40%;"}
Parts of image TCGA-2L-AAQI-01Z taken from [@BioPortal; @TCGA_data; @Slide]
:::

## Methods and Materials

```{r}
#| echo: true
#| eval: true
#| output: true
```

::::: rows
::: {.row height="50%"}
Materials:

-   Pancreatic Adenocarcinoma The Cancer Genome Atlas (TCGA) PanCancer dataset [@BioPortal; @TCGA_data]

-   R studio (R, tidyverse)

-   draw.io (just presentation)
:::

::: {.row height="50%" style="text-align: center;"}
Methodology

![](Projectflow.drawio.png){width="925"}
:::
:::::

## Describing the data (1) (Magnus)

-   Explain the division of variables trough the different datasets
-   Made of 184 patient samples and 63 clinical variables (demographics, diagnosis, staging, molecular metrics, outcomes).

------------------------------------------------------------------------

## Descring the data (2) (Magnus)

```{r}
#| echo: true
#| eval: true
#| output: true

iris
```

## PCA on numeric data

PCA reduced the data to a few components while retaining most of the variance.

PCA loadings were plotted and revealed groups of strongly correlated variables, indicating redundancy in the feature set.

```{r}
#| echo: false
#| eval: true
#| output: false
#| message: false


data_all <- data_metrics |>
  left_join(data_gene,  by = "Patient ID") |>
  left_join(data_score, by = "Patient ID") |>
  left_join(data_code,  by = "Patient ID") |>
  left_join(data_diag,  by = "Patient ID")

pca_data <- data_all |>
  select(
    where(is.numeric),
    -c(`Overall Survival (Months)`,
       `Disease Free (Months)`,
       `Months of disease-specific survival`,
       `Progress Free Survival (Months)`,
       `Disease Free Status (bin)`,
       `Disease Free (days)`, # loads of NA because some die
       `Days of disease-specific survival`,
       `Progress Free Survival (days)`
    ) 
  )  |> 
  drop_na()

pca_fit <- pca_data |> 
  select(-`Disease-specific Survival status (bin)`) |> 
  scale() |> 
  prcomp()
```

::::: columns
::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| output: false
#| message: false

pca_fit |> 
  tidy(matrix = "eigenvalues") |> 
  ggplot(aes(PC, cumulative)) +
  geom_col(fill = "#56B4E9", alpha = 0.8) +
  geom_hline(yintercept = 0.8,
             linetype = "dashed",
             color = "grey30",
             linewidth = 0.6) +
  scale_x_continuous(breaks = 1:14) +
  scale_y_continuous(
  breaks = c(0, 0.25, 0.5, 0.75, 0.8, 1),
  labels = scales::percent_format(),
  expand = expansion(mult = c(0, 0.01))
) +
  labs(
  x = "Principal component",
  y = "Cumulative variance across PCs",
  title = "Cumulative explained 
  variance by principal component"
)
```
:::

::: {.column width="50%"}
```{r}
#| echo: false
#| eval: true
#| output: true
#| message: false
#| fig-width: 7
#| fig-height: 6
#| fig-align: "center"
#| out-width: 90%

pca_fit |> 
  tidy(matrix = "eigenvalues") |> 
  ggplot(aes(PC, cumulative)) +
  geom_col(fill = "#56B4E9", alpha = 0.8) +
  geom_hline(yintercept = 0.8,
             linetype = "dashed",
             color = "grey30",
             linewidth = 0.6) +
  scale_x_continuous(breaks = 1:14) +
  scale_y_continuous(
  breaks = c(0, 0.25, 0.5, 0.75, 0.8, 1),
  labels = scales::percent_format(),
  expand = expansion(mult = c(0, 0.01))
) +
  theme_minimal() +
  labs(
  x = "Principal component",
  y = "Cumulative variance across PCs",
  title = "Cumulative explained variance by principal component"
)

```
:::
:::::

## [Genomic Alterations Across AJCC Cancer Stages]{.smalltitle}

Genomic instability is present at all AJCC stages, not just in advanced disease.

```{r}
#| echo: false
#| eval: true
#| output: false
#| message: false

# 0) Join data
data_gene_code = full_join(data_gene, data_code, by = "Patient ID")

# 1) Find stages with > 10 samples
stages_keep <- data_gene_code |>
  rename(NDSA_stage = `Neoplasm Disease Stage American Joint Committee on Cancer Code`) |>
  count(NDSA_stage, name = "n_samples") |>
  filter(n_samples > 10)

# 2) Labels
stage_labels <- stages_keep |>
  mutate(stage_label = str_c(NDSA_stage, " (n=", n_samples, ")")) |>
  select(NDSA_stage, stage_label)

# 3) Keep full data only for those stages
data_gene_code_filtered <- data_gene_code |>
  rename(NDSA_stage = `Neoplasm Disease Stage American Joint Committee on Cancer Code`) |>
  filter(`Mutation Count` < 5000,
         `Tumor Break Load` < 200,
         !is.na(NDSA_stage)) |> 
  semi_join(stages_keep, by = "NDSA_stage") 

# 4) Working data with labels ready
data_gene_code_filtered <- data_gene_code_filtered |>
  left_join(stage_labels, by = "NDSA_stage")
```

::::: columns
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| output: false
#| message: false
data_gene_code_filtered |>
  pivot_longer(
    cols = c(
      `Fraction Genome Altered`,
      `Mutation Count`,
      `Tumor Break Load`
    ),
    names_to = "Genomic_Metric",
    values_to = "Value"
  ) |>
  ggplot(aes(x = stage_label, y = Value)) +
  geom_violin() +
  geom_boxplot(width = 0.2) +
  facet_wrap(~ Genomic_Metric, 
             scales = "free_y", 
             nrow = 1) +
  theme(axis.text.x = element_text(angle = 45, 
                                   hjust = 1)) +
  labs(
    x = "AJCC stage (n per stage)",
    y = "Genomic metric")
```

-   Later stages tend to include more extreme values.
-   Overlap between neighboring stages, so stage alone doesn’t perfectly separate genomic burden.
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| eval: true
#| output: true
#| message: false
#| fig-width: 5
#| fig-height: 8
#| fig-align: "center"
#| out-width: 80%
data_gene_code_filtered |>
  pivot_longer(
    cols = c(
      `Fraction Genome Altered`,
      `Mutation Count`,
      `Tumor Break Load`
    ),
    names_to = "Genomic_Metric",
    values_to = "Value"
  ) |>
  ggplot(aes(x = stage_label, y = Value)) +
  geom_violin() +
  geom_boxplot(width = 0.2) +
  facet_wrap(~ Genomic_Metric, 
             scales = "free_y", 
             ncol = 1) +
  theme(axis.text.x = element_text(angle = 45, 
                                   hjust = 1)) +
  labs(
    x = "AJCC stage (n per stage)",
    y = "Genomic metric",
    title = "Genomic instability metrics across AJCC stages")
```
:::
:::::

## [Interaction between Hypoxia and Tumor Break Load, and its effects in Overall Survival (Days)]{.smalltitle}

```{r}
#| echo: false
#| eval: true
#| output: false
#| message: false


# Prepare data
data_heatmap <- data_gene |>
  full_join(data_diag, by = "Patient ID") |>
  full_join(data_score, by = "Patient ID") |>
  drop_na() |>
  # Pivot hypoxia scores long
  pivot_longer(
    cols = c(`Winter Hypoxia Score`, 
             `Buffa Hypoxia Score`),
    names_to = "Hypoxia_Score_Type",
    values_to = "Hypoxia_Value"
  ) |>
  mutate(
    Mut_Count_Bin = case_when(
      `Tumor Break Load` > median(`Tumor Break Load`, na.rm = TRUE) ~ "High Tumor Break Load",
      `Tumor Break Load` <= median(`Tumor Break Load`, na.rm = TRUE) ~ "Low Tumor Break Load")) |>
  group_by(Hypoxia_Score_Type) |>
  mutate(
    Hypoxia_Bin = case_when(
      Hypoxia_Value > median(Hypoxia_Value, na.rm = TRUE) ~ "High Hypoxia",
      Hypoxia_Value <= median(Hypoxia_Value, na.rm = TRUE) ~ "Low Hypoxia"))|>
  ungroup()|>
  group_by(Hypoxia_Score_Type, Mut_Count_Bin, Hypoxia_Bin) |>
  summarise(Median_Survival = median(`Overall Survival (days)`), .groups = 'drop')
```

::::: columns
::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| output: false
#| message: false

ggplot(data_heatmap, aes(x = Mut_Count_Bin, 
                         y = Hypoxia_Bin, 
                         fill = Median_Survival)) +
  geom_tile(color = "white") +
  geom_text(aes(label = round(Median_Survival, 0)), 
            color = "white", 
            size = 6) +
  scale_fill_gradient(
    low = "red",
    high = "#2ECC71",
    name = "Median Survival (Days)"
  ) + 
  facet_wrap(~ Hypoxia_Score_Type, ncol=1) +
  theme_minimal() + 
  theme(
      plot.title = element_text(hjust = 0.5, face = "bold", size = 16),
      plot.subtitle = element_text(hjust = 0.5),
      axis.text = element_text(color = "black"),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank()
    ) +
    labs(
      title = "Median Overall Survival (Days)",
      subtitle = "Interaction between Tumor Break Load and Hypoxia Score",
      x = "Tumor Break Load", 
      y = "Winter Hypoxia Score"
    )
```
:::

::: {.column width="50%"}
```{r}
#| echo: false
#| eval: true
#| output: true
#| message: false
#| fig-width: 7
#| fig-height: 6
#| fig-align: "center"
#| out-width: 90%

ggplot(data_heatmap, aes(x = Mut_Count_Bin, 
                         y = Hypoxia_Bin, 
                         fill = Median_Survival)) +
  geom_tile(color = "white") +
  geom_text(aes(label = round(Median_Survival, 0)), 
            color = "white", 
            size = 6) +
  scale_fill_gradient(
    low = "red",
    high = "#2ECC71",
    name = "Median Survival (Days)"
  ) + 
  facet_wrap(~ Hypoxia_Score_Type, ncol=1) +
  theme_minimal() + 
  theme(
      plot.title = element_text(hjust = 0.5, face = "bold", size = 16),
      plot.subtitle = element_text(hjust = 0.5),
      axis.text = element_text(color = "black"),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank()
    ) +
    labs(
      title = "Median Overall Survival (Days)",
      subtitle = "Interaction between Tumor Break Load and Hypoxia Score",
      x = "Tumor Break Load", 
      y = "Winter Hypoxia Score"
    )

```
:::
:::::

## Discussion (2) (Catarina)

## Discussion (3) (Lily)
- TMB and Mutation Count seem mostly independent of AJCC stage.

- However higher mutation burden looks to correlate with shorter survival, with TMB as the strongest predictor.

- Genomic instability behaves differently from mutation burden, showing some links to hypoxia and stage.

- Radiation therapy improves survival overall, with the greatest benefit observed in low-hypoxia tumors.

## Conclusion (Lily)
- Results for patients outside the 50–80 age range should be interpreted cautiously due to low sample counts.

- Predominantly White patient representation highlights the need for greater ethnic diversity.

- Limited variability in several categories may constrain findings.

- Future analyses could be strengthened by adding more clinical and molecular data and increasing sample diversity, including underrepresented groups.

more data ::::::::::::

## References

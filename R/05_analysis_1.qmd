---
title: "05_analysis_1"
format:
  html:
    embed-resources: true
editor: visual
---

## **Loading libraries**

```{r}
library("tidyverse")
library("dplyr")
library("here")
```

## **Loading data**

Loading the data from the previous augmentation step *03_augment*.

```{r}
#| message: false
data_metrics <- read_tsv(here("data","data_metrics_aug.tsv"))
data_gene <- read_tsv(here("data","data_gene_aug.tsv"))
data_score <- read_tsv(here("data","data_score_aug.tsv"))
data_code <- read_tsv(here("data","data_code_aug.tsv"))
data_diag <- read_tsv(here("data","data_diag_aug.tsv"))
```

-   **data_metrics** — patient demographics (age, sex, race, ancestry)
-   **data_gene** — genomic instability metrics (mutation count, TMB, fraction genome altered).
-   **data_score** — biological scores (aneuploidy, hypoxia, MSI).
-   **data_code** — cancer staging and clinical classification codes.
-   **data_diag** — diagnoses, survival outcomes, therapy history.

## Plotting

### Genomic Alterations & Instability (data_gene) 

```{r}
data_metrics |> 
  select(-c(`Genetic Ancestry Label`, `Race Category`, `Ethnicity Category`))

data_metrics_gene <- full_join( data_metrics, data_gene, by="Patient ID")
```

------------------------------------------------------------------------

```{r}
data_metrics_gene |>
  filter(`Mutation Count` < 5000) # take out outlier
```

```{r}
data_gene_code = full_join(data_gene, data_code, by = "Patient ID")
```

```{r}
data_gene_code |>
  filter(`Mutation Count` < 5000) |> 
  pivot_longer(cols = c(`Fraction Genome Altered`, 
                        `Mutation Count`, 
                        `TMB (nonsynonymous)`, 
                        `Tumor Break Load`),
               names_to = "Genomic_Metric", 
               values_to = "Value") |> 
ggplot(mapping = 
         aes(x = `Neoplasm Disease Stage American Joint Committee on Cancer Code`, 
             y = Value)) +
  geom_boxplot() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ Genomic_Metric, scales = "free_y")
```

Heatmap of hypoxia and MSI scores across patients or groups: Highlights patterns and clusters associated with tumor microenvironment, useful for exploratory group identification.  

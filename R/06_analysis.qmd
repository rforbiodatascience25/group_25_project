------------------------------------------------------------------------

\
\##**Loading Libraries**

Load in the necessary libraries.

```{r}
library("tidyverse")
library("dplyr")
library("here")
library(ggridges)
```

## **Loading data**

Load in the data from the augmentation step *03_augment*.

```{r}
data_metrics <- read_tsv(here("data","data_metrics_aug.tsv"))
data_gene <- read_tsv(here("data","data_gene_aug.tsv"))
data_score <- read_tsv(here("data","data_score_aug.tsv"))
data_code <- read_tsv(here("data","data_code_aug.tsv"))
data_diag <- read_tsv(here("data","data_diag_aug.tsv"))
```

\##**Plots**

It can be seen that for those who had neither a prior diagnosis or radiation therapy and for those who did not have radiation therapy but did have a prior diagnosis, there was a nearly 50-50 split on their survival status. However, for those that did have radiation therapy but did not have a prior diagnosis, there was a near 70-30 split on survival status. Due to the small number of patients who did not fit into the category of no radiation therapy and no prior diagnosis, these numbers may not necessarily be trustworthy. However, in general, this does follow the trend we would expect to see, where those who were not previously sick and who did go through with the therapy would be more likely to survive. It is interesting to see that prior diagnosis status did not seem to show much of an impact on survival status.

```{r}
Tile_Survival <- data.frame(
  Prior_Diagnosis = data_diag$`Prior Diagnosis`,
  Survival = data_diag$`Disease-specific Survival status`,
  Radiation_Therapy = data_diag$`Radiation Therapy`
)
Tile_Survival <- Tile_Survival %>%
  filter(!is.na(Radiation_Therapy), !is.na(Survival))

Tile_Survival %>%
  count(Prior_Diagnosis, Radiation_Therapy, Survival) %>%
  ggplot(aes(x = Prior_Diagnosis, y = Radiation_Therapy, fill = n)) +
  geom_tile() +
  facet_wrap(~ Survival) +
  geom_text(aes(label = n), color = "white") +
  labs(
    title = "Number of Patients Survival by Prior Diagnosis and Radiation Therapy",
    x = "Prior Diagnosis",
    y = "Radiation Therapy",
    fill = "Count"
  ) +
  theme_minimal()
```

GX was removed due to there being only 3 instances of it and also that it represents an inability to properly assign a grade. G4 was removed due to there being only 2 instances and therefore not being able to show statistacally significant data.

This plot shows that in both men and women, in all 3 grades, a majority of sampes were between the 40 to 80 age range. However, it is interesting to note, that in general, density was highest for females in all grades slightly before males. In G1 females seem to peak in their mid-60s, in G2 the peak is near early-70s, and in G3 the peak is near early-60s. For men however, in G1 the peak is near early-70s, in G2 the peak is also near early-70s, and for G3 the peak is near mid-70s. Along with this difference in ages between the sexes, it is also interesting to note that G3 is found more commonly at a younger age than G1 or G2. This could be important to note as it shows that a more advanced cancer being found in younger women.

```{r}
Density_Age <- data.frame(
  Age = data_metrics$`Diagnosis Age`,
  Neo_Grade = data_diag$`Neoplasm Histologic Grade`,
  Sex = data_metrics$Sex)

Density_Age <- Density_Age %>%
  filter(Neo_Grade != "GX", Neo_Grade != "G4")

ggplot(Density_Age, aes(x = Age, y = Neo_Grade, fill = Neo_Grade)) +
  geom_density_ridges(alpha = 0.7) +
  facet_wrap(~ Sex) +
  labs(
    title = "Age Distribution Across Neoplasm Histologic Grades",
    x = "Diagnosis Age",
    y = "Histologic Grade"
  ) +
  theme_ridges() +
  theme(legend.position = "none")
```

This plot shows that for both those who became tumor free and those who died from the tumor, a similar trend was followed where, in general, a higher TMB meant fewer months of survival. The trend was mainly differentiated in that there were more months survived for those who became tumor free. This follows the general trend that we would expect to see. However, it is interesting to note that in those who died with a tumor, there was a slight positive slope until after 1 TMB, where it then sharply drops. This could indicate that as long as a persons TMB is less than 1, they may have the same estimated survival time.

```{r}
Scatter_TMB <- data.frame(
  Months_Disease = data_diag$`Months of disease-specific survival`,
  Survival_Status = data_diag$`Disease-specific Survival status`,
  TMB = data_gene$`TMB (nonsynonymous)`)

Scatter_TMB <- Scatter_TMB %>%
  filter(TMB<10, !is.na(Survival_Status))

ggplot(Scatter_TMB, aes(x = TMB, y = Months_Disease)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "loess", se = FALSE, color = "blue") +
  facet_wrap(~ Survival_Status) +
  labs(
    title = "TMB vs Disease-Specific Survival by Survival Status",
    x = "TMB (nonsynonymous)",
    y = "Disease-Specific Survival (Months)"
  ) +
  theme_minimal()

```
